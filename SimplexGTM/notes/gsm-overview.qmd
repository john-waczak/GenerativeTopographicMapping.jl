---
title: "Generative Simplex Mapping"
subtitle: "Extending the GTM for Spectral Unmixing and Source Apportionment"
author: "John Waczak"
date: today
title-slide-attributes:
  data-background-image: /figures/prism.png
  data-background-size: cover
  data-background-opacity: "0.75"
mainfont: "Montserrat"
format: revealjs
---


## Generative Topographic Mapping (GTM) {.smaller}

:::: {.columns}
::: {.column width="40%" style="font-size: 75%;"}

- **Main Idea**: data in feature space are constrained to a low-dimensional manifold generated from a set of latent coordinates $\{\xi_i\}$
- **Goal**: construct a mapping from the latent space to the data space inspired by the SOM
- *Assumption 1*: Latent distribution is given by points arranged on grid such that $p(\xi) = \frac{1}{K}\sum\limits_k^K \delta(\xi - \xi_k)$
- *Assumption 2*: final distribution is Normal to account for noise that could break manifold assumption, i.e.: $p\left(x \mid \xi, W, \beta \right) = \mathcal{N}(\psi(\xi, W), \beta^{-1})$
- The transformation is governed by nonlinear mapping $\psi(\xi)$ which is accomplished via RBF functions with weights $W$, i.e. $\psi(\xi_k) = W\phi(\xi_k)$
- Fit the parameters $W$ and $\beta$ using **Expectation Maximization**

:::

::: {.column width="50%"}
![](./figures/gtm-diagram.png){.absolute top=200 right=-200 width="700"}

:::
::::



## Result {.smaller}

:::: {.columns}
::: {.column width="40%" style="font-size: 75%;"}
**Benefits:**

- using 2-dimensional latent space enables visualization of high-dim data
- projection of nodes into feature-space via $\psi(\xi_k)$ provides "endmembers" corresponding to each node
- Provides a good compromise by enabling both visualization (via 2-dim latent space) AND endmember extraction

**Limitations:**

- $\xi_i \in [-1, 1]$ and don't map directly to **endmember abundances** (should be between $0$ and $1$).
- Needed to use NS3 (a spectral distance measure) to infer abundance (e.g. rhodamine, algae, etc...)
- Assuming normal distribution in feature-space doesn't guarantee **non-negativity** of node spectra. In practice this isn't an issue but we would like a guarantee
:::

::: {.column width="50%"}
![](./figures/gtm-water.png){.absolute top=200 right=-200 width="700"}

:::
::::




# This problem comes up in multiple domains relevant to our work

## {.smaller}

:::: {.columns}
::: {.column width="50%"}
**Source Apportionment (PM)**

- *Goal:* identify signatures (i.e. concentration profiles) and relative abundance of sources of PM
- EPA has historically used 3 methods
- Chemical Mass Balance assumes knowledge of source profiles (e.g. from direct measurement) and decomposes data into relative abundances
- PMF: "positive" matrix factorization (later NMF) developed to directly decompose data to get both simultaneously
- UNIMX: sources are vertices of **simplex**. Finds simplex assuming enough samples fall on edges

:::
::: {.column width="50%"}
**Endemember Extraction & Spectral Unmixing (HSI)**

::: {style="font-size: 85%"}
- Goal: identify spectra corresponding to unique sources within a scene and determine relative abundance of sources in mixed signals
- Typically linear mixing is assumed, i.e. $X = AS + \epsilon$ where $A$ are abundances and $S$ are source profiles
- Vertex Component Analysis: Assumes pure spectra are vertices of a **simplex**
- NMF: non-negative matrix factorization
- Autoencoders: use hourglass-shaped NN to form encoder and decoder. Encodings correspond to abundance of each endmember and decoder can be used to identify the corresponding spectral signatures. Slow to train, but **nonlinear**
- Few probabilistic models (VAE can work here but are tricky)
:::
:::
::::


# Solution: Generative *Simplex* Mapping


## Simplex

:::: {.columns}
::: {.column width="40%" style="font-size: 75%;"}
- Abundances of mixtures can naturally be described using a simplex where each vertex corresponds to a pure substance (chemical, spectrum, etc...)
- [Barycentric coordinates](https://en.wikipedia.org/wiki/Barycentric_coordinate_system) describe the position within the simplex via $(\alpha_1, ..., \alpha_n)$ with $\sum_i \alpha_i = 1$
- We can replace the 2-d grid of the GTM with a regular grid on an $N$-simplex to model mixtures of $N$ pure substances
- This scales better to higher dimensions than a regular grid in $N$ dimensions
- A simplex with $N_v$ vertices and $k$ nodes per edge [corresponds to](https://en.wikipedia.org/wiki/Triangular_number) ${k + N_v - 2 \choose N_v -1}$

:::
::: {.column width="50%"}
![](./figures/simplex.png){.absolute top=100 right=-200 width="700"}
![](./figures/species-simplex.png){.absolute top=350 right=-200 width="500"}
:::
::::


## Enforcing non-negativity {.smaller}

:::: {.columns}
::: {.column width="60%" style="font-size: 75%;"}

- To enforce the non-negativity property of the feature space (concentrations and spectra physically must be non-negative), we can use a multivariate log-normal distribution
- This means a posterior pdf given by $p\left(x \mid \xi, W, \beta\right) = \left(\frac{\beta}{2\pi} \right)^{B/2} \left(\prod\limits_b^B\frac{1}{x_b}\right)\exp\left(-\frac{\beta}{2}\lVert \psi(\xi; W) - \ln(x) \rVert^2\right)$
- This leads to a nearly identical EM algorithm
- Mean: $\exp\left(\psi(\xi; W) + \frac{1}{2\beta}\right)$
- Median: $\exp\left(\psi(\xi; W)\right)$
- Mode: $\exp\left(\psi(\xi; W) - \beta^{-1}\right)$

:::

::: {.column width="40%"}

![](./figures/lognormal-pdf.png){.absolute top=150 right=-75 width="400"}

:::
::::

